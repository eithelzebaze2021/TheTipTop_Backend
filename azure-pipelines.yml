# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- main

pool:
  vmImage: ubuntu-latest
  
steps:

- task: Maven@4
  inputs:
    mavenPomFile: 'pom.xml'
    publishJUnitResults: true
    testResultsFiles: '**/surefire-reports/TEST-*.xml'
    javaHomeOption: 'JDKVersion'
    jdkVersionOption: '1.17'
    mavenVersionOption: 'Default'
    mavenAuthenticateFeed: false
    effectivePomSkip: false
    sonarQubeRunAnalysis: false
    sqMavenPluginVersionChoice: 'pom'
- task: Docker@2
  inputs:
    containerRegistry: 'furiousduckdockerhub'
    repository: 'eithelzebaze/furiosduck-grp1'
    command: 'buildAndPush'
    Dockerfile: '**/Dockerfile'

- task: AzureSpringCloud@0
  inputs:
    azureSubscription: 'Azure subscription 1(bbba1c5d-93ca-49bd-8365-50b203245cb4)'
    Action: 'Deploy'
    AzureSpringCloud: '/subscriptions/bbba1c5d-93ca-49bd-8365-50b203245cb4/resourceGroups/FuriousDuckRes/providers/Microsoft.AppPlatform/Spring/spring-tip-top'
    AppName: 'spring-tip-top'
    DeploymentType: 'CustomContainer'
    UseStagingDeployment: true
    RegistryServer: 'eithelzebaze/furiosduck-grp1'
    RegistryUsername: 'Innocent-2013'
    RegistryPassword: 'Innocent-2013'
    ImageName: '21'
    